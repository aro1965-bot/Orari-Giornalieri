<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>I miei Orari</title>
<style>
  body { font-family: system-ui; padding: 20px; background:#f5f5f5; }
  h2 { margin-bottom: 10px; }
  input, button { font-size: 18px; margin: 5px 0; padding:5px; }
  ul { padding-left: 20px; }
  li { margin: 4px 0; }
  .totali { margin-top:15px; font-weight:bold; }
  button { cursor:pointer; background:#4CAF50; color:white; border:none; border-radius:5px; }
  button:hover { background:#45a049; }
</style>
</head>
<body>
  <h2>I miei orari di lavoro</h2>

  <input type="date" id="day" placeholder="Giorno"><br>
  <input type="time" id="start">
  <input type="time" id="end"><br>

  <button onclick="save()">Salva turno</button>
  <button onclick="exportCSV()">Esporta CSV</button>

  <ul id="list"></ul>

  <div class="totali">
    Ore totali del mese: <span id="monthlyTotal">0</span>
  </div>

<script>
// Funzioni principali
function save() {
  const d = day.value, s = start.value, e = end.value;
  if (!d || !s || !e) { alert('Compila tutti i campi'); return; }
  const diff = getHours(s,e);
  let data = JSON.parse(localStorage.getItem('orari') || '[]');
  data.push({d,s,e,ore:diff});
  localStorage.setItem('orari', JSON.stringify(data));
  render();
}

function render() {
  let data = JSON.parse(localStorage.getItem('orari') || '[]');
  data.sort((a,b)=>a.d.localeCompare(b.d));
  const list = document.getElementById('list');
  list.innerHTML = data.map(x=>`<li>${x.d}: ${x.s} â†’ ${x.e} (${x.ore} h)</li>`).join('');
  document.getElementById('monthlyTotal').textContent = getMonthlyTotal(data);
}

function getHours(start,end){
  const [sh,sm] = start.split(':').map(Number);
  const [eh,em] = end.split(':').map(Number);
  let diff = (eh+em/60) - (sh+sm/60);
  if(diff<0) diff=0; // in caso di errore
  return Math.round(diff*100)/100;
}

function getMonthlyTotal(data){
  return data.reduce((sum,x)=>sum+x.ore,0);
}

// Esporta CSV
function exportCSV(){
  let data = JSON.parse(localStorage.getItem('orari') || '[]');
  if(data.length===0){ alert('Nessun dato da esportare'); return; }
  let csv = 'Giorno,Inizio,Fine,Ore\n';
  data.forEach(x=>{ csv+=`${x.d},${x.s},${x.e},${x.ore}\n`; });
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Orari.csv';
  a.click();
  URL.revokeObjectURL(url);
}

// Carica dati all'apertura
render();
</script>
</body>
</html>
 
 
